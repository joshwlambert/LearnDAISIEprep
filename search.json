[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Island Biology DAISIE Practical",
    "section": "",
    "text": "Welcome to the DAISIE computer practical of the Island Biology course. Here you will find the material to learn how to use the DAISIE ecosystem of R packages to analyse the ecology and evolution of island communities. These tools have been developed to answer research questions in island biogeography and macroevolution. We will apply them to a case study of a group of beetles from the Caribbean islands.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Welcome</span>"
    ]
  },
  {
    "objectID": "installation.html",
    "href": "installation.html",
    "title": "2  Installation",
    "section": "",
    "text": "2.1 Install required software:",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Installation</span>"
    ]
  },
  {
    "objectID": "installation.html#install-required-software",
    "href": "installation.html#install-required-software",
    "title": "2  Installation",
    "section": "",
    "text": "R\nRstudio\nFigtree",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Installation</span>"
    ]
  },
  {
    "objectID": "installation.html#install-required-r-packages",
    "href": "installation.html#install-required-r-packages",
    "title": "2  Installation",
    "section": "2.2 Install required R packages",
    "text": "2.2 Install required R packages\nOpen and run this script in Rstudio. This should install all required R packages (may take a while!).\n\ninstall.packages('DAISIE',dependencies = TRUE)\ninstall.packages('DAISIEprep',dependencies = TRUE)\ninstall.packages('ape',dependencies = TRUE)\n\nONLY if you run into problems with ‘ggtree’ package. Make sure you have the latest version of R, then use:\n\nif (!requireNamespace(\"BiocManager\", quietly = TRUE))\n    install.packages(\"BiocManager\")\nBiocManager::install(\"ggtree\")\n\nCheck if packages load correctly\n\nlibrary(DAISIE)\nlibrary(ape)\nlibrary(DAISIEprep)",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Installation</span>"
    ]
  },
  {
    "objectID": "introduction.html",
    "href": "introduction.html",
    "title": "3  Introduction",
    "section": "",
    "text": "3.1 Evolutionary island biogeography using DAISIE\nIn this practical we will estimate rates of colonisation, speciation and extinction for a (hypothetical) genus of beetles found in the Caribbean. We will then use these estimated rates to simulate how the number of species has changed through time in this taxonomic group. The practical will use mainly the R packages DAISIE and DAISIEprep. We will learn how to interpret and prepare data for analyses using DAISIE, how to fit DAISIE models to phylogenetic data, and how to simulate phylogenies of island communities.\nThe practical is divided into 4 main parts (please follow them in this order):",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "introduction.html#sec-introduction",
    "href": "introduction.html#sec-introduction",
    "title": "3  Introduction",
    "section": "",
    "text": "Read the instructions of the graded assignment.\nLearn how to use DAISIEprep to prepare and extract data (1-2 hours). DAISIEprep is an R package that allows users to format phylogenetic data for subsequent analyses in DAISIE.\nLearn how to use DAISIE to estimate parameters and simulate islands (1-2 hours). DAISIE is an R package that allows fitting island biogeography models and simulating islands.\nApply the above approaches to a dataset of beetles from the Caribbean. Writing up this part is the graded assignment.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "assignment.html",
    "href": "assignment.html",
    "title": "4  Assignment Instructions",
    "section": "",
    "text": "4.1 Case study: Insula beetles from Jamaica\nThe beetle genus Insula (imaginary genus, does not exist in reality), is a large genus of beetles of approximately 50 species, distributed in Central America and the Caribbean islands. The majority of the species in the genus are endemic to islands, and it is thought to be a great example of colonisation and diversification on islands. The species of the genus occur in forests, shrublands or freshwater habitats. They are good swimmers but cannot survive in sea water.\nOne of the most diverse islands for the genus Insula is Jamaica, a mid-size Caribbean island with a complex geological history. It is thought that Jamaica has a continental origin, but has been isolated from other landmasses for approximately 5 million years. The mainland pool of closely related species of beetles in the continent (i.e. species that could have colonised the islands) has been estimated to be approximately 1000 species. More than 15 species of Insula are thought to be endemic to Jamaica, with a few species being only recently described or discovered. However, the evolutionary island biogeography of Insula on Jamaica remains unknown.\nA very well-sampled time-calibrated phylogeny for the genus has recently been published, covering all the island where Insula occurs. A few species have been recently discovered and were not sampled in the phylogeny. There is no evidence of recently extinct species. The authors of the study performed an ancestral range reconstruction, so it is possible to infer the ancestral areas and number of colonisation events.\nMaking use of the knowledge you gathered from DAISIEprep and DAISIE (next steps in this practical), in combination with the phylogenetic tree and the species checklist provided, you can extract data for the island of Jamaica and fit DAISIE to the data.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Assignment Instructions</span>"
    ]
  },
  {
    "objectID": "assignment.html#sec-assignment",
    "href": "assignment.html#sec-assignment",
    "title": "4  Assignment Instructions",
    "section": "",
    "text": "Beetles (Phylopic); Caribbean Islands (Google Earth)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Assignment Instructions</span>"
    ]
  },
  {
    "objectID": "assignment.html#instructions-of-written-assignment",
    "href": "assignment.html#instructions-of-written-assignment",
    "title": "4  Assignment Instructions",
    "section": "4.2 Instructions of written assignment",
    "text": "4.2 Instructions of written assignment\nWrite a 3-page report of the computer practical.\n\nFollow the self-guided tutorials of the computer practical and run analyses using DAISIE to answer all of the required questions in an individually written report.\nIn your report, briefly describe the methodology used for the analyses of Insula, your main results, and limitations of the analyses.\nFormat: .doc and .pdf, 2-3 pages, Calibri font (or similar), minimum font size 10.\nInclude any tables and figures that you think could be relevant (be creative!), as long as they are well explained (including legends) and keep within the 2-3 page limit.\nDo not include code in the assignment (unless you want to point out something specific with the script).\n\nFocus on the interpretation of the results from a biological perspective.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Assignment Instructions</span>"
    ]
  },
  {
    "objectID": "DAISIEprep.html",
    "href": "DAISIEprep.html",
    "title": "5  DAISIEprep",
    "section": "",
    "text": "5.1 Using DAISIEprep pack to extract and format data\nIn this part of the practical, the main features of DAISIEprep are explained. DAISIEprep (Lambert et al. 2023) is an R package that facilitates formatting of data for subsequent use in DAISIE.\nA typical DAISIEprep pipeline is as follows:\nThe DAISIEprep tutorial is divided into the following sections:",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>DAISIEprep</span>"
    ]
  },
  {
    "objectID": "DAISIEprep.html#sec-daisieprep",
    "href": "DAISIEprep.html#sec-daisieprep",
    "title": "5  DAISIEprep",
    "section": "",
    "text": "Identify island colonisation events for the taxonomic group of interest from time-calibrated phylogenetic trees\nAssign an island endemicity status (endemic, non-endemic, not present) to each of the species\nAutomatically extract times of colonisation of the island and diversification within the island from the phylogenies\nAdd any missing species\nFormat data for DAISIE.\n\n\n\nSingle Phylogeny example - Using a simulated phylogeny including island and non-island species, learn how to extract and format island data for running DAISIE.\nAdding missing species - Learn how to add missing species, lineages, etc, to your DAISIE data list.\nPrepare object for analyses in DAISIE",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>DAISIEprep</span>"
    ]
  },
  {
    "objectID": "DAISIEprep.html#single-phylogeny-example",
    "href": "DAISIEprep.html#single-phylogeny-example",
    "title": "5  DAISIEprep",
    "section": "5.2 Single Phylogeny Example",
    "text": "5.2 Single Phylogeny Example\nIn this section we demonstrate a simple example of extracting and formatting data from a single phylogeny. We use a simulated phylogeny, which facilitates explaining how the data is structured.\n\n5.2.1 Load the required packages:\n\nlibrary(DAISIEprep)\nlibrary(ape)\n\n\n\n5.2.2 Simulate example phylogeny\nWe now simulate a phylogeny using the package ape.\n\nset.seed(\n  4,\n  kind = \"Mersenne-Twister\",\n  normal.kind = \"Inversion\",\n  sample.kind = \"Rejection\"\n)\nphylo &lt;- ape::rcoal(10)\n\nImportant: DAISIEprep requires the tip labels (taxon names) in the phylogeny to be formatted as genus name and species name separated by an underscore (e.g. “Canis_lupus”, “Species_1”).\nHere we add tip labels (representing our species) to the simulated phylogeny. In this case, all taxa sampled are different plant species from the same genus.\n\nphylo$tip.label &lt;- c(\"Plant_a\", \"Plant_b\", \"Plant_c\", \"Plant_d\", \"Plant_e\",\n                     \"Plant_f\", \"Plant_g\", \"Plant_h\", \"Plant_i\", \"Plant_j\")\n\nThen we convert the phylogeny to a phylo4 class, defined in the package phylobase. This allows users to easily work with data for each tip in the phylogeny, for example whether they are endemic to the island or not.\n\nphylo &lt;- phylobase::phylo4(phylo)\nphylobase::plot(phylo)\n\n\n\n\n\n\n\n\nNow we have a phylogeny in the phylo4 format to which we can easily append data.\n\n\n5.2.3 Add distribution information to the tips of the tree\nSpecify tips corresponding to species from your focal island by specifying that they are endemic and/or non-endemic to the island. In the example below, species Plant_h is found on the island but it not endemic, and species Plant_f and Plant_e are found on the island and are endemic to the island. All other species on the phylogeny are NOT present on the island.\n\nisland_species &lt;- data.frame(\n  tip_labels = c(\"Plant_h\",\n                 \"Plant_f\",\n                 \"Plant_e\")\n  ,\n  tip_endemicity_status = c(\"nonendemic\",\"endemic\",\"endemic\"))\n\nNow that we know which species are present on the island, we can assign an endemicity status to all the species in the phylogeny.\n\nendemicity_status &lt;- create_endemicity_status(\n  phylo = phylo,\n  island_species = island_species\n)\n\nAnd append this information to the phylogeny object:\n\nphylod &lt;- phylobase::phylo4d(phylo, endemicity_status)\n\nWe can now visualise our phylogeny with the island endemicity statuses plotted at the tips. This uses the ggtree and ggplot2 packages.\n\nplot_phylod(phylod = phylod)\n\n\n\n\n\n\n\n\nAs you can see, in the example phylogeny, there appear to be 2 separate colonisation events of the island - one which has led to species Plant_f and Plant_e and other that has led to the non-endemic species Plant_h.\n\n\n5.2.4 Extract data using DAISIEprep\nNow that we can see the tips that are present on the island, we can extract them to form our island community data set that can be used in the DAISIE R package to fit likelihood models of island colonisation and diversification.\nBefore we extract species, we first create an object to store all of the island colonists’ information. This uses the island_tbl class introduced in this package (DAISIEprep). This island_tbl object can then easily be converted to a DAISIE data list using the function create_daisie_data (more information on this below).\n\nisland_tbl &lt;- island_tbl()\nisland_tbl\n#&gt; Class:  Island_tbl \n#&gt; [1] clade_name      status          missing_species col_time       \n#&gt; [5] col_max_age     branching_times min_age         species        \n#&gt; [9] clade_type     \n#&gt; &lt;0 rows&gt; (or 0-length row.names)\n\nWe can see that this is an object containing an empty data frame. In order to fill this data frame with information on the island colonisation and diversification events we can run:\n\nisland_tbl_min &lt;- extract_island_species(\n  phylod = phylod,\n  extraction_method = \"min\"\n)\nisland_tbl_min\n#&gt; Class:  Island_tbl \n#&gt;   clade_name     status missing_species  col_time col_max_age branching_times\n#&gt; 1    Plant_e    endemic               0 0.1925924       FALSE    0.154371....\n#&gt; 2    Plant_h nonendemic               0 0.1233674       FALSE              NA\n#&gt;   min_age      species clade_type\n#&gt; 1      NA Plant_e,....          1\n#&gt; 2      NA      Plant_h          1\n\nThe function extract_island_species() is the main function in DAISIEprep to extract data from the phylogeny. In the example above, we used the “min” extraction algorithm. The “min” algorithm extracts island community data assuming no back-colonisation from the island to the mainland. Each row in the island_tbl corresponds to a separate colonisation of the island. In this case, two colonist lineages were correctly identified using the ‘min’ extraction algorithm, one endemic and another non-endemic. Each row in the table corresponds to one colonisation event.\nHowever, if back-colonisation is frequent (for example, one species within a large endemic island radiation colonised another island or mainland), we recommend using the “asr” algorithm, which extracts the most likely colonisations inferred in an ancestral area reconstruction. To use the “asr” algorithm, we first need to know the probability of the ancestors of the island species being present on the island to determine the time of colonisation. To do this, we can fit one of many ancestral state reconstruction methods. Here we use the “mk” model (which uses a continuous-time markov model to reconstruct ancestral states), as it is a simple method that should prove reliable for reconstructing the ancestral species areas (i.e. on the island or not on the island) for most cases. First, we translate our extant species endemicity status to a numeric representation of whether that species is on the island.\n\nphylod &lt;- add_asr_node_states(phylod = phylod, asr_method = \"mk\")\n\nNow we can plot the phylogeny, which this time includes the node labels for the presence/absence on the island in ancestral nodes.\n\nplot_phylod(phylod = phylod)\n\n\n\n\n\n\n\n\n\nSidenote (optional): if you are wondering what the probabilities are at each node and whether this should influence your decision to pick a preference for island or mainland when the likelihoods for each state are equal, we can plot the probabilities at the nodes to visualise the ancestral state reconstruction using plot_phylod(phylod = phylod, node_pies = TRUE).\nNow we can extract island colonisation and diversification times from the phylogeny with asr using the reconstructed ancestral states of island presence/absence.\n\nisland_tbl_asr &lt;- extract_island_species(\n  phylod = phylod,\n  extraction_method = \"asr\"\n)\n\n\nisland_tbl_asr\n#&gt; Class:  Island_tbl \n#&gt;   clade_name     status missing_species  col_time col_max_age branching_times\n#&gt; 1    Plant_e    endemic               0 0.1925924       FALSE    0.154371....\n#&gt; 2    Plant_h nonendemic               0 0.1233674       FALSE              NA\n#&gt;   min_age      species clade_type\n#&gt; 1      NA Plant_e,....          1\n#&gt; 2      NA      Plant_h          1\n\nBy comparing island_tbl_min and island_tbl_asr you can see the differences in the 2 extraction methods.\n\n\nall.equal(island_tbl_min,island_tbl_asr)\n#&gt; [1] TRUE\n\nIn this case, the results using “asr” and “min” are exactly the same. For the purposes of this practical, we will proceed with the results from “asr” (island_tbl_asr). For convenience, let’s rename the object to island_tbl.\n\nisland_tbl&lt;-island_tbl_asr\n\nYou can visualize the contents of the island_tbl object to try and figure out what they mean.\n\nView(island_tbl)\n\nFor example, the code below shows you the names of the species included in each lineage:\n\nisland_tbl@island_tbl$species\n#&gt; [[1]]\n#&gt; [1] \"Plant_e\" \"Plant_f\"\n#&gt; \n#&gt; [[2]]\n#&gt; [1] \"Plant_h\"",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>DAISIEprep</span>"
    ]
  },
  {
    "objectID": "DAISIEprep.html#adding-missing-species",
    "href": "DAISIEprep.html#adding-missing-species",
    "title": "5  DAISIEprep",
    "section": "5.3 Adding missing species",
    "text": "5.3 Adding missing species\nIt is often the case that phylogenetic data is not available for some island species or even for entire lineages present in the island community. But we can still include these species in our DAISIE analyses using DAISIEprep. This section is about the tools that DAISIEprep provides in order to handle missing data, and generally to handle species that are missing and need to be input into the data manually.\nFor this section, as with the previous section, the core data structure we are going to work with is the island_tbl. We will use the island_tbl for the example plant dataset produced in the last section.\n\n5.3.1 Adding missing species to an island clade that has been sampled in the phylogeny\nThis option is for cases in which a clade has been sampled in the phylogeny, and at least 1 colonisation or 1 branching time is available in the datalist, but 1 or more species from that clade were not sampled. For this example, we imagine that 2 species have not been sampled, and that we want to add them as missing species to the lineage containing species “Plant_e” that is sampled in the phylogeny. To assign two missing species to this clade we use the function add_missing_species() The argument species_to_add_to uses a representative sampled species from that island clade to work out which colonist in the island_tbl to assign the specified number of missing species (num_missing_species) to. You can find out which species are already sampled in each lineage using:\n\nisland_tbl@island_tbl$species\n#&gt; [[1]]\n#&gt; [1] \"Plant_e\" \"Plant_f\"\n#&gt; \n#&gt; [[2]]\n#&gt; [1] \"Plant_h\"\n\nNow run the code:\n\nisland_tbl &lt;- add_missing_species(\n  island_tbl = island_tbl,\n  # num_missing_species equals total species missing\n  num_missing_species = 2,\n  # name of a sampled species you want to \"add\" the missing to\n  # it can be any in the clade\n  species_to_add_to = \"Plant_e\"\n)\n\nThe new island table now has missing species added to the lineage we wanted to:\n\nisland_tbl@island_tbl$missing_species\n#&gt; [1] 2 0\n\nWith the new missing species added to the island_tbl we can repeat the conversion steps above using create_daisie_data() to produce data accepted by the DAISIE model.\n\ndata_list &lt;- create_daisie_data(\n  data = island_tbl,\n  island_age = 12,\n  num_mainland_species = 100,\n  precise_col_time = TRUE\n)\n\n\n\n5.3.2 Adding an entire lineage when a phylogeny is not available for the lineage.\nFor cases when the missing species belong to a lineage that has not been sampled in the phylogeny. Assuming we did not have any phylogenetic data or colonisation time estimate for the island clade, we can insert species as missing and specify them as a separate lineage. Because no colonisation and branching times are known for this lineage, when this lineage later gets processed by the DAISIE inference model it will be assumed it colonised the island any time between the island’s formation and the present.\nThe input needed are:\n\nisland_tbl to add to an existing island_tbl\nclade_name a name to represent the new clade addeed, can either be a specific species from the clade or a genus name, or another name that represent those species\nstatus either “endemic” or “nonendemic”\nspecies a vector of species names contained within colonist (if applicable)\nmissing_species In the case of a lineage with just 1 species (i.e. not an island radiation) the number of missing species is zero, as by adding the colonist it already counts as one automatically. In the case of an island clade of more than one species, the number of missing species in this case should be n-1.\n\nExample for adding lineage with 1 species:\n\nisland_tbl &lt;- add_island_colonist(\n  island_tbl = island_tbl,\n  clade_name = \"Plant_y\",\n  status = \"endemic\",\n  # clade with just 1 species, missing_species = 0\n  # because adding the lineage already counts as 1\n  missing_species = 0,\n  col_time = NA_real_,\n  col_max_age = FALSE,\n  branching_times = NA_real_,\n  min_age = NA_real_,\n  clade_type = 1,\n  species = \"Plant_a\"\n)\n\nExample for adding lineage with 5 species (“Plant_a”, “Plant_b”, “Plant_c”, “Plant_d”, “Plant_e”) to a lineage called “Plant_radiation”\n\nisland_tbl &lt;- add_island_colonist(\n  island_tbl = island_tbl,\n  clade_name = \"Plant_radiation\",\n  status = \"endemic\",\n  # the total species is 5 and all are missing\n  # but we add missing_species = 4 because\n  # adding the lineage already counts as 1\n  missing_species = 4,\n  col_time = NA_real_,\n  col_max_age = FALSE,\n  branching_times = NA_real_,\n  min_age = NA_real_,\n  clade_type = 1,\n  species = c(\"Plant_a\", \"Plant_b\", \"Plant_c\",\n              \"Plant_d\", \"Plant_e\")\n)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>DAISIEprep</span>"
    ]
  },
  {
    "objectID": "DAISIEprep.html#prepare-object-for-analyses-in-daisie",
    "href": "DAISIEprep.html#prepare-object-for-analyses-in-daisie",
    "title": "5  DAISIEprep",
    "section": "5.4 Prepare object for analyses in DAISIE",
    "text": "5.4 Prepare object for analyses in DAISIE\nConvert to data object to be used in DAISIE\nNow that we have the island_tbl we can convert this to the DAISIE data list to be used by the DAISIE inference model. To convert to the DAISIE data list (i.e. the input data of the DAISIE inference model) we use create_daisie_data(), providing the island_tbl as input. We also need to specify:\n\nThe age of the island or archipelago. Here we use an island age of twelve million years (island_age = 12).\nWhether the colonisation times extracted from the phylogenetic data should be considered precise (precise_col_time = TRUE). We will not discuss the details of this here, but briefly by setting this to TRUE the data will tell the DAISIE model that the colonisation times are known without error. Setting precise_col_time = FALSE will change tell the DAISIE model that the colonisation time is uncertain and should interpret this as the upper limit to the time of colonisation and integrate over the uncertainty between this point and either the present time or to the first branching point (either speciation or divergence into subspecies).\nThe number of species in the mainland source pool. Here we set it to 100 (num_mainland_species = 100). This will be used to calculate the number of species that could have potentially colonised the island but have not. When we refer to the mainland pool, this does not necessarily have to be a continent, it could be a different island if the source of species immigrating to an island is largely from another nearby island (a possible example of this could be Madagascar being the source of species colonising Comoros). This information is used by the DAISIE model to calculate the colonisation rate of the island.\n\n\ndata_list &lt;- create_daisie_data(\n  data = island_tbl,\n  island_age = 12,\n  num_mainland_species = 100,\n  precise_col_time = TRUE\n)\n\nBelow we show two elements of the DAISIE data list produced. The first element data_list[[1]] in every DAISIE data list is the island community metadata, containing the island age and the number of species in the mainland pool that did not leave descendants on the island at the present day. This is important information for DAISIE inference, as it is possible some mainland species colonised the island but went extinct leaving no trace of their island presence.\n\ndata_list[[1]]\n#&gt; $island_age\n#&gt; [1] 12\n#&gt; \n#&gt; $not_present\n#&gt; [1] 96\n\nNext is the first element containing information on island colonists (every element data_list[[x]] in the list after the metadata contains information on individual island colonists). This contains the name of the colonist, the number of missing species, and the branching times, which is a vector containing the age of the island, the colonisation time and the times of any cladogenesis events. Confusingly, it may be that the branching times vector contains no branching times: when there are only two numbers in the vector these are the island age followed by the colonisation time. Then there is the stac, which stands for status of colonist. This is a number which tells the DAISIE model how to identify the endemicity and colonisation uncertainty of the island colonist (these are explained here if you are interested). Lastly, the type1or2 defines which macroevolutionary regime an island colonist is in. By macroevolutionary regime we mean the set of rates of colonisation, speciation and extinction for that colonist. Most applications will assume all island clades have the same regime and thus all are assigned type 1. However, if there is a priori expectation that one clade significantly different from the rest, e.g. the Galápagos finches amongst the other terrestrial birds of the Galápagos archipelago this clade can be set to type 2.\n\ndata_list[[2]]\n#&gt; $colonist_name\n#&gt; [1] \"Plant_e\"\n#&gt; \n#&gt; $branching_times\n#&gt; [1] 12.0000000  0.1925924  0.1543711\n#&gt; \n#&gt; $stac\n#&gt; [1] 2\n#&gt; \n#&gt; $missing_species\n#&gt; [1] 2\n#&gt; \n#&gt; $type1or2\n#&gt; [1] 1\n\nThis datalist is now ready to be used in the DAISIE maximum likelihood inference model from the R package DAISIE.\nEnd of the DAISIEprep tutorial!",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>DAISIEprep</span>"
    ]
  },
  {
    "objectID": "DAISIE.html",
    "href": "DAISIE.html",
    "title": "6  DAISIE",
    "section": "",
    "text": "6.1 Fitting DAISIE models using the Galápagos birds as example\nIn this part of the practical, we will learn how to use DAISIE. As a demonstraction, we are going to fit the DAISIE model to phylogenetic data for species of native land birds of the Galápagos islands (data from Valente, Phillimore and Etienne 2015 Ecology Letters; and Valente et al 2020 Nature). We will use software DAISIE to estimate rates of speciation, colonisation and extinction in the Galápagos. We will simulate islands with these estimated rates to see how species diversity has varied through time in the Galápagos.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>DAISIE</span>"
    ]
  },
  {
    "objectID": "DAISIE.html#sec-daisie",
    "href": "DAISIE.html#sec-daisie",
    "title": "6  DAISIE",
    "section": "",
    "text": "Phylogenies of Galápagos birds\n\n\n\n\n6.1.1 Prepare the R environment\nEmpty workspace of existing previous objects, just in case.\n\nrm(list = ls())\n\n\n\n6.1.2 Load the required packages:\n\nlibrary(DAISIE)\nlibrary(ape)\n\n\n\n6.1.3 Load and visualise Galapágos bird data\nThe dataset of Galápagos birds includes colonisation and branching times for a total of 27 species of terrestrial birds of the Galápagos islands, distributed across 8 lineages. Some of the lineages have only 1 species, e.g. the Galápagos dove Zenaida. Others have radiated, including the Darwin’s finch radiation (16 species) and the mockingbirds Mimus radiation (4 species). Note: the dataset we will use is slightly different from the example dataset that is included as data in the DAISIE R package.\n\n6.1.3.1 Load Galápagos DAISIE datalist\nDownload the Galápagos dataset file: galapagos_datalist.Rdata\nStore it locally.\nLoad it into R, by setting the path to the location of the file on your computer:\n\nload(file = \"PATH_TO_YOUR_DATALIST_FILE\")\n\n\n\n6.1.3.2 View Galápagos datalist\nJust type:\n\ngalapagos_datalist\n\nThis datalist is of the same format that DAISIEprep produces (e.g., same format as the data_list object that you just produced in the DAISIEprep tutorial).\nView your Galápagos datalist by scrolling up and down in R. Or use function View()\n\nView(galapagos_datalist)\n\nYou can find detailed information using the R documentation file:\n\n? Galapagos_datalist \n\nTo view the top of the list\n\ngalapagos_datalist[[1]]\n#&gt; $island_age\n#&gt; [1] 4\n#&gt; \n#&gt; $not_present\n#&gt; [1] 992\n\nThis element contains the island age as well as all the mainland species that do not have extant descendants on the island. These are important pieces of information for DAISIE.\nTo view just the Mimus colonisation:\n\ngalapagos_datalist[[4]]\n#&gt; $colonist_name\n#&gt; [1] \"Mimus\"\n#&gt; \n#&gt; $branching_times\n#&gt; [1] 4.00000 3.99999 3.68000 2.93000 0.29000\n#&gt; \n#&gt; $stac\n#&gt; [1] 6\n#&gt; \n#&gt; $missing_species\n#&gt; [1] 0\n#&gt; \n#&gt; $type1or2\n#&gt; [1] 1\n\nThe first element of the $branching_times item is the island age, followed by the colonisation time and the branching times (if any). The $stac item is a code that tells DAISIE whether the lineage is endemic, non-endemic, and whether or not a precise age or a maximum-age should be used.\nOr to view just the Darwin’s finches lineage:\n\ngalapagos_datalist[[3]]\n#&gt; $colonist_name\n#&gt; [1] \"Finches\"\n#&gt; \n#&gt; $branching_times\n#&gt;  [1] 4.0000 3.0280 1.3227 0.8223 0.4286 0.3462 0.2450 0.1180 0.0808 0.0756\n#&gt; [11] 0.0527 0.0525 0.0327 0.0322 0.0221 0.0118\n#&gt; \n#&gt; $stac\n#&gt; [1] 2\n#&gt; \n#&gt; $missing_species\n#&gt; [1] 1\n#&gt; \n#&gt; $type1or2\n#&gt; [1] 1\n\nAs you can see, there is 1 missing species in the Darwin’s finch lineage - this species was not sampled in the phylogeny, so does not have a corresponding branching time in the $branching_times item. However, $missing_species item tells DAISIE that it needs to consider one extra species in its computations.\n\n\n6.1.3.3 Visualise Galápagos data\nYou can visualize the data in a different way using:\n\nDAISIE_plot_island(galapagos_datalist)\n\n\n\n\n\n\n\n\nThe above plot shows the 8 colonisation events (independent lineages), the time of colonisation, number of species sampled in each lineage (n), number of missing species (m) and the times of cladogenetic speciation events (horizontal lines). The dashed horizontal line is the island age. Unfilled symbols indicate that the time of colonisation was set as “max-age” (not precise), that is, the colonisation time could have happened any time between the time plotted and the present. This applies for instance to lineages with stem ages older than the island age, whose age is then set to be the age of the island (as was the cases of genus Mimus, whose stem age is older than the island age of 4 million years).\n\n\n6.1.3.4 Plot age versus diversity\nTo visualise the diversity of each lineage according to their age:\n\nDAISIE_plot_age_diversity(galapagos_datalist)\n\n\n\n\n\n\n\n\nThe above plot shows the number of species per lineage plotted against their colonisation time. You can see that one lineage stands out, it is not the oldest lineage, but it has 16 species, many more than the other lineages (there is no label, but it corresponds to the Darwin’s finches). One of the lineages, Mimus, is not plotted, because it’s age is set as max-age, that is why the number of species is 23 (27-4 species=23).\n\n\n\n\n\n\n6.1.4 Fitting DAISIE models\nWe will now fit three different DAISIE models using maximum likelihood, using the function DAISIE_ML. The DAISIE function searches for the parameters that maximise the likelihood of the data given the specified model. We will then compare the likelihoods of the 3 different models to see which one is preferred\nWe will fit the 3 different DAISIE models to the phylogenetic data contained in the object galapagos_datalist.\n\n\n\n6.1.4.1 Fit a full DAISIE model (M1)\nThe first model (M1) we will fit is a full DAISIE model with 5 parameters. The parameters in DAISIE are always placed in this order:\n\nCladogenesis rate (lambda_c) (unit: cladogenesis events per island lineage per time unit)\nExtinction rate (mu) (unit: extinction events per island lineage per time unit)\nCarrying capacity (K) (unit: number of species)\nColonisation rate (gamma) (unit: colonisation events per mainland lineage per time unit)\nAnagenesis rate (lambda_a) (unit: anagenesis events per island lineage per time unit)\n\nImportant settings of the DAISIE_ML function:\n\ninitparsopt refers to the starting parameters of the maximum likelihood optimisation (the search for the optimal parameters). 1.5 is the starting cladogenesis rate, 1.1 is the starting extinction rate, 20 is the initial carrying capacity (20 species), 0.009 is the colonisation rate; 1.1 is the initial anagenesis rate.\nidparsopt shows the parameters to optimise, in this case all 5, so 1:5\nparsfix and idparsfix are set to NULL because we are not fixing any parameters this time.\n\nThe code below takes a while to run.\n\nM1_results &lt;- DAISIE_ML(\n  datalist = galapagos_datalist,\n  initparsopt = c(1.5,1.1,20,0.009,1.1),\n  ddmodel = 11,\n  idparsopt = 1:5,\n  parsfix = NULL,\n  idparsfix = NULL\n)\nM1_results\n#&gt;   lambda_c       mu       K       gamma     lambda_a    loglik df conv\n#&gt; 1 1.258226 1.136924 9968506 0.004957378 1.251793e-06 -84.78145  5    0\n\nThe output gives the ML parameters values, the loglikelihood, and the number of parameters (df).\n\n\n\n6.1.4.2 Fit model with no carrying-capacity (M2)\nAs you can see above, the value of K in M1 is very high (hundreds of thousands of species). This suggest that there may be no upper bound to diversity (so K is in fact infinite). So let’s try a model without K as a free parameter.\nThe second model (M2) is just like M1, but we will fix K to be infinite. In comparison to M1, we now remove the 3rd parameter (carrying capacity) from the initparsopt and idparsopt settings. So we now have only parameters 1,2,4 and 5. We fix the parameter number 3 to Inf (carrying capacity K fixed to infinite):\n\nM2_results &lt;- DAISIE_ML(\n  datalist = galapagos_datalist,\n  initparsopt = c(1.5,1.1,0.009,1.1),\n  idparsopt = c(1,2,4,5),\n  parsfix = Inf,\n  idparsfix = 3,\n  ddmodel = 0\n)\nM2_results\n#&gt;   lambda_c       mu   K      gamma     lambda_a    loglik df conv\n#&gt; 1 1.264389 1.149378 Inf 0.00505558 1.662578e-05 -84.78088  4    0\n\n\n\n\n\n6.1.4.3 Fit model with no carrying capacity AND no anagenesis (M3)\nNow, it appears that the parameter of anagenesis is close to 0 in M2 (see above). Perhaps a model without anagenesis will perform well.\nThe third model (M3) is like M2, but with no carrying-capacity and no anagenesis. This time we switch off the 3rd and 5th parameters (carrying-capacity and anagenesis). We fix the 3rd parameter (K) to infinite; and the 5th parameter (anagenesis) to zero:\n\nM3_results &lt;- DAISIE_ML(\n  datalist = galapagos_datalist,\n  initparsopt = c(1.5,1.1,0.009),\n  idparsopt = c(1,2,4),\n  parsfix = c(Inf,0),\n  idparsfix = c(3,5),\n  ddmodel = 0\n)\nM3_results\n#&gt;   lambda_c       mu   K       gamma lambda_a    loglik df conv\n#&gt; 1 1.263034 1.146225 Inf 0.005040353        0 -84.78082  3    0\n\n\n\n\n\n6.1.4.4 Select the best model using AIC\nNow compare the log-likelihoods of the 3 models. They all have similar likelihoods, but one has fewer parameters, so it is preferred. Which model is it?\nA more proper way to compare the models is using AIC (or other information criteria), which takes into account the number of parameters and the loglikelihood.\nCreate new function to compute AIC values base on the likelihood values and number of parameters for each model.\n\n\nAIC_compare &lt;- function(LogLik,k){\n  aic &lt;- (2 * k) - (2 * LogLik)\n  return(aic)\n}\n\nFill in the values from your data in this format:\nAIC_compare(c(likelihood_M1,likelihood_M2,likelihood_M3), c(n_parameters_M1,n_parameters_M2,n_parameters_M3)).\n\nAICs &lt;- AIC_compare(LogLik = c(M1_results$loglik,M2_results$loglik,M3_results$loglik),\n                    k = c(M1_results$df,M2_results$df,M3_results$df))\nnames(AICs) &lt;- c('M1','M2','M3')\nAICs\n#&gt;       M1       M2       M3 \n#&gt; 179.5629 177.5618 175.5616\n\nThe model with the lowest AIC value is the preferred model. (In this case, M3)\n\n\n\n\n\n6.1.5 Simulate islands\nNow let’s use the ML parameters we estimated from the Galápagos bird data to simulate islands. Choose the parameters of the best model. We will simulate for 4 million years (time = 4). M is the mainland pool (keep it at 1000).\n\n6.1.5.1 Simulate islands with the parameters estimated from the best model for the Galápagos bird data (takes a while to run, you can reduce number of replicates if you want)\n\nGalapagos_sims &lt;- DAISIE_sim(\n  time = 4,\n  M = 1000,\n  pars = c(1.26, 1.146, Inf, 0.005,0),\n  replicates = 100,\n  plot_sims = FALSE)\n\n\n\n6.1.5.2 Plot the species-through-time plots resulting from the simulations\n\nDAISIE_plot_sims(Galapagos_sims)\n\n\n\n\n\n\n\n\n\n\n6.1.5.3 Play with different simulations settings\nPlay with different parameter settings in DAISIE_sim (e.g. changing extinction rate, colonisation rate, island age, mainland pool size, replicates). Is equilibrium reached?\n\n\n\n\n6.1.5.4 Comparison with bird data from the Azores islands\nNow let’s briefly compare with simulations for a completely different dataset, of birds from the Azores archipelago (Atlantic Ocean). Load datatable containing Azores bird data from Valente et al 2017 (Current Biology)\n\ndata(Macaronesia_datalist)\nAzores &lt;- Macaronesia_datalist[[1]]\n\n\n6.1.5.4.1 Visualise Azores data\n\nDAISIE_plot_island(Azores)\n\n\n\n\n\n\n\n\nThree of the species are extinct and only known from fossils.\n\n\n6.1.5.4.2 Simulate Azores with pre-identified ML parameters\n\nAzores_sims &lt;- DAISIE_sim(\n  time = 6.3,\n  M = 300,\n  pars = c(0,1.053151832,Inf,0.052148979,0.512939011),\n  replicates = 100,\n  plot_sims = FALSE)\n\n\n\n\n\n6.1.5.4.3 Plot the species-through-time plot for the Azores from the resulting from the simulations\n\nDAISIE_plot_sims(Azores_sims)\n\n\n\n\n\n\n\n\nHow does the Azores plot differ from that of the Galápagos?\n\nThe end of the DAISIE practical. Well done! Now you are ready to work on the Insula exercise",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>DAISIE</span>"
    ]
  },
  {
    "objectID": "exercise.html",
    "href": "exercise.html",
    "title": "7  Insula beetles exercise",
    "section": "",
    "text": "7.1 Insula beetles excercise\nAfter you have finished the DAISIEprep and DAISIE practicals, you can begin applying these techniques to the Insula dataset.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Insula beetles exercise</span>"
    ]
  },
  {
    "objectID": "exercise.html#sec-questions",
    "href": "exercise.html#sec-questions",
    "title": "7  Insula beetles exercise",
    "section": "7.2 Questions to answer in your report",
    "text": "7.2 Questions to answer in your report\nThe aim is to be able to answer the following questions:\n\nHow many times has Insula colonised the Caribbean islands?\nHow many times has Insula colonised Jamaica?\nHow many radiations have occurred on Jamaica?\nWhat are the rates of colonisation, speciation and extinction for Insula in Jamaica?\nIs there evidence for diversity-dependence in the Insula species of Jamaica?\nIs there evidence for equilibrium dynamics on the island of Jamaica?\nHow has the diversity of Insula on Jamaica changed through time (according to DAISIE simulations)?\nModify one or two parameters of your choice and run simulations again under those parameters. How does this affect the simulations? Describe.\n\nIn sum, you need to load the phylogeny into R, use DAISIEprep to extract the DAISIE datalist. Then, fit DAISIE to that datalist to estimate parameters (extinction, colonisation, speciation, carrying capacity, and simulate islands), and to simulate islands. Make use of the DAISIEprep and DAISIE tutorials as well as the Insula tree, tables and figures provided. With these analyses you will be able to answer all the questions\nYou can find all the relevant data here:\n\nInsula.tre the phylogenetic tree of Insula (to be loaded into R for analyses, but also visualized using Figtree): note that the species have numbers instead of latin names (Spec 1, Spec 2, etc).\n\n\n\n\n\n\n\n\n\n\n\nInsula_checklist.xlsx: A species checklist including the distribution, endemicity status as well as the species that are missing from the phylogeny but which should be considered in the DAISIE analyses.\nFigure_Insula_Tip_states.pdf: A figure of the phylogeny with the tips coloured by the island where the species occurs.\n\n\n\n\nPhylogeny showing the geographical distribution of the extant species\n\n\n\nFigure_Insula_ancestral_state_reconstruction.pdf: A figure of an ancestral range reconstruction for the genus.\n\n\n\n\nAncestral area reconstruction\n\n\nTips:\nFor the DAISIE analyses use:\nIsland age: 5 million years\nMainland pool size: 1000 species\nDon’t forget to add the missing species.\nAfter the practical, a file with an example of how to run the Insula analyses will be provided, which can be used as a guideline in case you had difficulties completing the practical.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Insula beetles exercise</span>"
    ]
  }
]
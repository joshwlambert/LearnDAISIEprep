<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Luis Valente">

<title>3. DAISIE_Galapagos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="3.DAISIE_Galapagos_files/libs/clipboard/clipboard.min.js"></script>
<script src="3.DAISIE_Galapagos_files/libs/quarto-html/quarto.js"></script>
<script src="3.DAISIE_Galapagos_files/libs/quarto-html/popper.min.js"></script>
<script src="3.DAISIE_Galapagos_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="3.DAISIE_Galapagos_files/libs/quarto-html/anchor.min.js"></script>
<link href="3.DAISIE_Galapagos_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="3.DAISIE_Galapagos_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="3.DAISIE_Galapagos_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="3.DAISIE_Galapagos_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="3.DAISIE_Galapagos_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">3. DAISIE_Galapagos</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Luis Valente </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="course-island-biology-2024" class="level3">
<h3 class="anchored" data-anchor-id="course-island-biology-2024">Course: Island Biology 2024</h3>
</section>
<section id="fitting-daisie-models-using-the-galápagos-birds-as-example" class="level2">
<h2 class="anchored" data-anchor-id="fitting-daisie-models-using-the-galápagos-birds-as-example">2 - Fitting DAISIE models using the Galápagos birds as example</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Galapagos_picture.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Phylogenies of Galápagos birds</figcaption>
</figure>
</div>
<section id="in-this-practical-we-are-going-to-fit-the-daisie-model-to-phylogenetic-data-for-species-of-native-land-birds-of-the-galápagos-islands-data-from-valente-phillimore-and-etienne-2015-ecology-letters-and-valente-et-al-2020-nature.-we-will-use-software-daisie-to-estimate-rates-of-speciation-colonisation-and-extinction-in-the-galápagos.-we-will-simulate-islands-with-these-estimated-rates-to-see-how-species-diversity-has-varied-through-time-in-the-galápagos." class="level5">
<h5 class="anchored" data-anchor-id="in-this-practical-we-are-going-to-fit-the-daisie-model-to-phylogenetic-data-for-species-of-native-land-birds-of-the-galápagos-islands-data-from-valente-phillimore-and-etienne-2015-ecology-letters-and-valente-et-al-2020-nature.-we-will-use-software-daisie-to-estimate-rates-of-speciation-colonisation-and-extinction-in-the-galápagos.-we-will-simulate-islands-with-these-estimated-rates-to-see-how-species-diversity-has-varied-through-time-in-the-galápagos.">In this practical we are going to fit the <code>DAISIE</code> model to phylogenetic data for species of native land birds of the Galápagos islands (data from Valente, Phillimore and Etienne 2015 <em>Ecology Letters</em>; and Valente et al 2020 <em>Nature</em>). We will use software <code>DAISIE</code> to estimate rates of speciation, colonisation and extinction in the Galápagos. We will simulate islands with these estimated rates to see how species diversity has varied through time in the Galápagos.</h5>
<p>Prepare the R environment to run the practical. Empty workspace of existing previous objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load required packages <a href="https://cran.r-project.org/web/packages/DAISIE/index.html">DAISIE</a> and <a href="https://cran.r-project.org/web/packages/ape/ape.pdf">ape</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DAISIE)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-format-and-visualise-galapágos-bird-data" class="level3">
<h3 class="anchored" data-anchor-id="load-format-and-visualise-galapágos-bird-data">2.1 - Load, format and visualise Galapágos bird data</h3>
<p>The dataset of Galápagos birds includes colonisation and branching times for a total of 27 species of terrestrial birds of the Galápagos islands, distributed across 8 lineages. Some of the lineages have only 1 species, whereas some have radiated (including the Darwin’s finch radiation, 16 species). <strong>Note</strong>: the dataset we will use is slightly different from the example dataset that is included as data in the <code>DAISIE</code> R package.</p>
<section id="load-datatable" class="level4">
<h4 class="anchored" data-anchor-id="load-datatable">Load Datatable</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>galapagos_table<span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="at">file=</span><span class="st">'/Users/luis/Desktop/IRIOMOTE/LECTURES:PRACTICALS:COURSES/RUG_Evolutionary_Processes_Mar2022/Galapagos_practical/BACK_UP_FILES/Galapagos_datatable.txt'</span>,<span class="at">header=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="view-galápagos-datable" class="level4">
<h4 class="anchored" data-anchor-id="view-galápagos-datable">View Galápagos datable</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(galapagos_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each row in the table corresponds to a different colonisation event. The first element of the “branching times” column is the time of colonisation of that lineage. When there is more than one value in that column this indicates the branching times (speciation events within that lineage that have taken place on the island).</p>
</section>
<section id="create-daisie-datalist-from-the-datatable" class="level4">
<h4 class="anchored" data-anchor-id="create-daisie-datalist-from-the-datatable">Create DAISIE datalist from the datatable</h4>
<p>We will use the DAISIE function <code>DAISIE_dataprep</code> to create a datalist that can be used in subsequent DAISIE analyses. We will set an island age of 4 million years for the Galápagos archipelago and a mainland pool size of 1000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>galapagos_datalist<span class="ot">&lt;-</span><span class="fu">DAISIE_dataprep</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">datatable =</span> galapagos_table,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">island_age =</span> <span class="dv">4</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">M =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Colonisation time of 4.49 for Mimus is older than island age</code></pre>
</div>
</div>
<p>As you can see, the age of the <em>Mimus</em> lineage is older than the age of 4 million years we have set for age of the Galápagos. The age of <em>Mimus</em> in the datatable is based on the stem age of the genus in the phylogeny, and we know that the stem age may be an overestimate for the colonisation time because there may have been extinctions along that branch that are no longer visible in the data. What <code>DAISIE_dataprep</code> does in this case is to set the age of <em>Mimus</em> as a maximum age, where the colonisation could have happened any time between the island age of 4 My and the present.</p>
</section>
<section id="view-galápagos-datalist" class="level4">
<h4 class="anchored" data-anchor-id="view-galápagos-datalist">View Galápagos datalist</h4>
<p>Just type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>galapagos_datalist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View your Galápagos datalist by scrolling up and down in R. You can find detailed information using the R documentation file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>? Galapagos_datalist </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or to view just the <em>Mimus</em> colonisation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>galapagos_datalist[[<span class="dv">4</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$colonist_name
[1] "Mimus"

$branching_times
[1] 4.00000 3.99999 3.68000 2.93000 0.29000

$stac
[1] 6

$missing_species
[1] 0

$type1or2
[1] 1</code></pre>
</div>
</div>
<p>The first element of the <code>$branching_times</code> item is the island age, followed by the colonisation time and the branching times (if any). The <code>$stac</code> item is a code that tells DAISIE whether the lineage is endemic, non-endemic, and whether or not max-age should be used.</p>
<p>Or to view just the Darwin’s finches lineage:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>galapagos_datalist[[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$colonist_name
[1] "Finches"

$branching_times
 [1] 4.0000 3.0280 1.3227 0.8223 0.4286 0.3462 0.2450 0.1180 0.0808 0.0756
[11] 0.0527 0.0525 0.0327 0.0322 0.0221 0.0118

$stac
[1] 2

$missing_species
[1] 1

$type1or2
[1] 1</code></pre>
</div>
</div>
<p>As you can see, there is 1 missing species in the Darwin’s finch lineage - this species was not sampled in the phylogeny, so does not have a corresponding branching time in the <code>$branching_times</code> item. However, <code>$missing_species</code> item tells DAISIE that it needs to consider one extra species in its computations.</p>
</section>
<section id="visualise-galápagos-data" class="level4">
<h4 class="anchored" data-anchor-id="visualise-galápagos-data">Visualise Galápagos data</h4>
<p>You can visualize the data in a different way using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_plot_island</span>(galapagos_datalist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3.DAISIE_Galapagos_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The above plot shows the 8 colonisation events (independent lineages), the time of colonisation, number of species sampled in each lineage (n), number of missing species (m) and the times of cladogenetic speciation events (horizontal lines). The dashed horizontal line is the island age. Unfilled symbols indicate that the time of colonisation was set as “max-age”, that is, the colonisation time could have happened any time between the time plotted and the present. This applies for instance to lineages with stem ages older than the island age, whose max-age is then set to be the age of the island (as was the cases of genus <em>Mimus</em>, whose stem age in the <code>galapagos_table</code> was older than the island age of 4 million years).</p>
</section>
<section id="plot-age-versus-diversity" class="level4">
<h4 class="anchored" data-anchor-id="plot-age-versus-diversity">Plot age versus diversity</h4>
<p>To visualise the diversity of each lineage according to their age:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_plot_age_diversity</span>(galapagos_datalist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3.DAISIE_Galapagos_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The above plot shows the number of species per lineage plotted against their colonisation time. You can see that one lineage - Darwin’s finches - stands out, it is not the oldest lineage, but it has 16 species, many more than the other lineages. One of the lineages, <em>Mimus</em>, is not plotted, because it’s age is set as max-age.<br>
</p>
<p><br>
</p>
</section>
</section>
<section id="fitting-daisie-models" class="level3">
<h3 class="anchored" data-anchor-id="fitting-daisie-models">2.2 – Fitting DAISIE models</h3>
<p>We will now fit three different DAISIE models using maximum likelihood, using the function <code>DAISIE_ML</code>. The DAISIE function searches for the parameters that maximise the likelihood of the data given the specified model. We will then compare the likelihoods of the 3 different models to see which one is preferred</p>
<p>We will fit the 3 different DAISIE models to the phylogenetic data contained in the object <code>galapagos_datalist</code>.</p>
<p><br>
</p>
<section id="fit-a-full-daisie-model-m1" class="level4">
<h4 class="anchored" data-anchor-id="fit-a-full-daisie-model-m1">Fit a full DAISIE model (M1)</h4>
<p>The first model (M1) we will fit is a full DAISIE model with 5 parameters. The parameters in DAISIE are always placed in this order:</p>
<ol type="1">
<li>Cladogenesis (lambda_c)</li>
<li>Extinction (mu)</li>
<li>Carrying capacity (K)</li>
<li>Colonisation (gamma)</li>
<li>Anagenesis (lambda_a)</li>
</ol>
<p>Important settings of the <code>DAISIE_ML</code> function:</p>
<ul>
<li><p><code>initparsopt</code> refers to the starting parameters of the maximum likelihood optimisation (the search for the optimal parameters). 1.5 is the starting cladogenesis rate, 1.1 is the starting extinction rate, 20 is the initial carrying capacity (20 species), 0.009 is the colonisation rate; 1.1 is the initial anagenesis rate.</p></li>
<li><p><code>idparsopt</code> shows the parameters to optimise, in this case all 5, so 1:5</p></li>
<li><p><code>parsfix</code> and <code>idparsfix</code> are set to NULL because we are not fixing any parameters this time.</p></li>
</ul>
<p><strong>The code below takes a while to run.</strong></p>
<div class="cell" data-hash="3.DAISIE_Galapagos_cache/html/ML_DAISIE_M1_20e2317b82211356676dff3b37e6396b">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_ML</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">datalist =</span> galapagos_datalist,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">initparsopt =</span> <span class="fu">c</span>(<span class="fl">1.5</span>,<span class="fl">1.1</span>,<span class="dv">20</span>,<span class="fl">0.009</span>,<span class="fl">1.1</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddmodel =</span> <span class="dv">11</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idparsopt =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parsfix =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">idparsfix =</span> <span class="cn">NULL</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lambda_c       mu       K       gamma     lambda_a    loglik df conv
1 1.258226 1.136924 9968506 0.004957378 1.251793e-06 -84.78145  5    0</code></pre>
</div>
</div>
<p>The output gives the ML parameters values, the loglikelihood, and the number of parameters (df).<br>
</p>
</section>
<section id="fit-model-with-no-carrying-capacity-m2" class="level4">
<h4 class="anchored" data-anchor-id="fit-model-with-no-carrying-capacity-m2">Fit model with no carrying-capacity (M2)</h4>
<p>As you can see above, the value of K in M1 is very high (hundreds of thousands of species). This suggest that there may be no upper bound to diversity (so K is in fact infinite). So let’s try a model without K as a free parameter.</p>
<p>The second model (M2) is just like M1, but we will fix K to be infinite. In comparison to M1, we now remove the 3rd parameter (carrying capacity) from the <code>initparsopt</code> and <code>idparsopt</code> settings. So we now have only parameters 1,2,4 and 5. We fix the parameter number 3 to <code>Inf</code> (carrying capacity K fixed to infinite):</p>
<div class="cell" data-hash="3.DAISIE_Galapagos_cache/html/ML_DAISIE_M2_e9e776873377b23dc3f195c8520c7f58">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_ML</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">datalist =</span> galapagos_datalist,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">initparsopt =</span> <span class="fu">c</span>(<span class="fl">1.5</span>,<span class="fl">1.1</span>,<span class="fl">0.009</span>,<span class="fl">1.1</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">idparsopt =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">parsfix =</span> <span class="cn">Inf</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">idparsfix =</span> <span class="dv">3</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddmodel=</span><span class="dv">0</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lambda_c       mu   K      gamma     lambda_a    loglik df conv
1 1.264389 1.149378 Inf 0.00505558 1.662578e-05 -84.78088  4    0</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="fit-model-with-no-carrying-capacity-and-no-anagenesis-m3" class="level4">
<h4 class="anchored" data-anchor-id="fit-model-with-no-carrying-capacity-and-no-anagenesis-m3">Fit model with no carrying capacity AND no anagenesis (M3)</h4>
<p>Now, it appears that the parameter of anagenesis is close to 0 in M2 (see above). Perhaps a model without anagenesis will perform well.</p>
<p>The third model (M3) is like M2, but with no carrying-capacity and no anagenesis. This time we switch off the 3rd and 5th parameters (carrying-capacity and anagenesis). We fix the 3rd parameter (K) to infinite; and the 5th parameter (anagenesis) to zero:</p>
<div class="cell" data-hash="3.DAISIE_Galapagos_cache/html/ML_DAISIE_M3_65dfe2dbf1998e5ed8315524f33dc85e">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_ML</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">datalist =</span> galapagos_datalist,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">initparsopt =</span> <span class="fu">c</span>(<span class="fl">1.5</span>,<span class="fl">1.1</span>,<span class="fl">0.009</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">idparsopt =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">parsfix =</span> <span class="fu">c</span>(<span class="cn">Inf</span>,<span class="dv">0</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">idparsfix =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ddmodel=</span><span class="dv">0</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  lambda_c       mu   K       gamma lambda_a    loglik df conv
1 1.263034 1.146225 Inf 0.005040353        0 -84.78082  3    0</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="select-the-best-model-using-aic" class="level4">
<h4 class="anchored" data-anchor-id="select-the-best-model-using-aic">Select the best model using AIC</h4>
<p>Now compare the log-likelihoods of the 3 models. They all have similar likelihoods, but one has fewer parameters, so it is preferred. Which model is it?</p>
<p>A more proper way to compare the models is using AIC (or other information criteria), which takes into account the number of parameters and the loglikelihood.</p>
<p>Create new function to compute AIC values base on the likelihood values and number of parameters for each model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>AIC_compare<span class="ot">&lt;-</span> <span class="cf">function</span>(LogLik,k){</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  aic <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>k)<span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span>LogLik)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(aic)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fill in the values from your data in this format:</p>
<p><code>AIC_compare(c(likelihood_M1,likelihood_M2,likelihood_M3), c(n_parameters_M1,n_parameters_M2,n_parameters_M3))</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>AICs<span class="ot">&lt;-</span><span class="fu">AIC_compare</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">84.78145</span> ,<span class="sc">-</span><span class="fl">84.78088</span>, <span class="sc">-</span><span class="fl">84.78082</span>),<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(AICs)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'M1'</span>,<span class="st">'M2'</span>,<span class="st">'M3'</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>AICs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      M1       M2       M3 
179.5629 177.5618 175.5616 </code></pre>
</div>
</div>
<p>The model with the <strong>lowest</strong> AIC value is the preferred model. (In this case, M3)</p>
<p><br>
</p>
</section>
</section>
<section id="simulate-islands" class="level3">
<h3 class="anchored" data-anchor-id="simulate-islands">2.3 - Simulate islands</h3>
<p>Now let’s use the ML parameters we estimated from the Galápagos bird data to simulate islands. Choose the parameters of the best model. We will simulate for 4 million years (time = 4). M is the mainland pool (keep it at 1000).</p>
<section id="simulate-islands-with-the-parameters-estimated-from-the-best-model-for-the-galápagos-bird-data-takes-a-while-to-run-you-can-reduce-number-of-replicates-if-you-want" class="level4">
<h4 class="anchored" data-anchor-id="simulate-islands-with-the-parameters-estimated-from-the-best-model-for-the-galápagos-bird-data-takes-a-while-to-run-you-can-reduce-number-of-replicates-if-you-want">Simulate islands with the parameters estimated from the best model for the Galápagos bird data (takes a while to run, you can reduce number of replicates if you want)</h4>
<div class="cell" data-hash="3.DAISIE_Galapagos_cache/html/DAISIE_sim_dac45b49dbc7092df2812610b47b439d">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Galapagos_sims<span class="ot">&lt;-</span><span class="fu">DAISIE_sim</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">time=</span><span class="dv">4</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">M=</span><span class="dv">1000</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pars=</span><span class="fu">c</span>(<span class="fl">1.26</span>, <span class="fl">1.146</span>, <span class="cn">Inf</span>, <span class="fl">0.005</span>,<span class="dv">0</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">replicates=</span> <span class="dv">100</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sims =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-the-species-through-time-plots-resulting-from-the-simulations" class="level4">
<h4 class="anchored" data-anchor-id="plot-the-species-through-time-plots-resulting-from-the-simulations">Plot the species-through-time plots resulting from the simulations</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_plot_sims</span>(Galapagos_sims)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3.DAISIE_Galapagos_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="play-with-different-simulations-settings" class="level4">
<h4 class="anchored" data-anchor-id="play-with-different-simulations-settings">Play with different simulations settings</h4>
<p>Play with different parameter settings in <code>DAISIE_sim</code> (e.g.&nbsp;changing extinction rate, colonisation rate, island age, mainland pool size, replicates). Is equilibrium reached?</p>
<p><br>
</p>
</section>
<section id="comparison-with-bird-data-from-the-azores-islands" class="level4">
<h4 class="anchored" data-anchor-id="comparison-with-bird-data-from-the-azores-islands">Comparison with bird data from the Azores islands</h4>
<p>Now let’s brielfy compare with simulatiosn for a completely different dataset, of birds from the Azores archipelago (Atlantic Ocean). Load datatable containing Azores bird data from Valente et al 2017 (<em>Current Biology</em>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Macaronesia_datalist)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Azores<span class="ot">&lt;-</span>Macaronesia_datalist[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="visualise-azores-data" class="level5">
<h5 class="anchored" data-anchor-id="visualise-azores-data">Visualise Azores data</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_plot_island</span>(Azores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3.DAISIE_Galapagos_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Three of the species are extinct and only known from fossils.</p>
</section>
<section id="simulate-azores-with-pre-identified-ml-parameters" class="level5">
<h5 class="anchored" data-anchor-id="simulate-azores-with-pre-identified-ml-parameters">Simulate Azores with pre-identified ML parameters</h5>
<div class="cell" data-hash="3.DAISIE_Galapagos_cache/html/DAISIE_sim_Azores_361681c5407db8d4f3e0c5908cd28545">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Azores_sims<span class="ot">&lt;-</span><span class="fu">DAISIE_sim</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">time=</span><span class="fl">6.3</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">M=</span><span class="dv">300</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pars=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.053151832</span>,<span class="cn">Inf</span>,<span class="fl">0.052148979</span>,<span class="fl">0.512939011</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">replicates=</span> <span class="dv">100</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_sims=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
</p>
</section>
<section id="plot-the-species-through-time-plot-for-the-azores-from-the-resulting-from-the-simulations" class="level5">
<h5 class="anchored" data-anchor-id="plot-the-species-through-time-plot-for-the-azores-from-the-resulting-from-the-simulations">Plot the species-through-time plot for the Azores from the resulting from the simulations</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DAISIE_plot_sims</span>(Azores_sims)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="3.DAISIE_Galapagos_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How does the Azores plot differ from that of the Galápagos?</p>
<p><br>
The end of part 2. Well done!</p>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>